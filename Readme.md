# Сервис отчетов по конверсии товаров

## Описание проекта

Сервис предназначен для работы с отчетами по конверсии просмотров/оплат товаров. Он позволяет пользователям запрашивать отчеты, которые формируются асинхронно и возвращаются через HTTP/GRPC интерфейс.

## Основные функции

- Прием запросов на формирование отчетов через шину сообщений (Kafka)
- Хранение состояния отчетов в PostgreSQL
- Предоставление результатов отчетов через HTTP и GRPC интерфейсы
- Оптимизация запросов к базе данных для уменьшения нагрузки
- Кэширование результатов отчетов для повторных запросов

## Технологический стек

- .NET 6/7
- PostgreSQL
- Kafka
- Docker
- GRPC
- xUnit/NUnit (для тестов)

## Архитектура решения

Сервис реализован с использованием Clean Architecture и разделен на следующие слои:

1. **API Layer** - HTTP/GRPC контроллеры
2. **Application Layer** - бизнес-логика и DTO
3. **Domain Layer** - основные модели и интерфейсы
4. **Infrastructure Layer** - реализация репозиториев, работа с БД и message bus

## API Endpoints

### GRPC API

- `GetReportResult` - получить отчет
- `RequestReport` - запросить новый отчет

### Message Queue

Сервис подписывается на очередь `report-requests` для получения новых запросов на отчеты.

## Тестирование

Для запуска тестов выполните:

```bash
dotnet test
```

Тесты покрывают:
- Бизнес-логику формирования отчетов
- Работу с базой данных
- Обработку сообщений из очереди
- API контроллеры

## Оптимизации

Для уменьшения нагрузки на БД реализованы:
- Кэширование результатов отчетов
- Дедупликация запросов за один период